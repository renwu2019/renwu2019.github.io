<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>java8新特性 | 学习记录</title>
      <link href="/2021/03/24/java8/"/>
      <url>/2021/03/24/java8/</url>
      
        <content type="html"><![CDATA[<h1 id="一、java8发展"><a href="#一、java8发展" class="headerlink" title="一、java8发展"></a>一、java8发展</h1><h3 id="1-jdk5"><a href="#1-jdk5" class="headerlink" title="1. jdk5"></a>1. jdk5</h3><ul><li>自动装箱与拆箱</li><li>并发库</li><li>枚举，常用于代表某些状态值，标识符，或者一些特定的类型。</li><li>静态导入， import static</li><li><strong>变长参数</strong>，三个点，要求参数类型相同，且是参数列表的最后一项。</li><li>泛型，本质：参数化类型。</li><li>for-each循环</li></ul><h3 id="2-jdk6"><a href="#2-jdk6" class="headerlink" title="2.jdk6"></a>2.jdk6</h3><ul><li>Desktop类和SystemTray类，调系统的方法，如打开浏览器等</li><li>轻量级Http Server API</li><li>使用Compiler API，可以写字符串模板</li><li>插入式注解处理API</li><li>用Console开发控制台程序</li></ul><h3 id="3-jdk7"><a href="#3-jdk7" class="headerlink" title="3.jdk7"></a>3.jdk7</h3><ul><li><p><strong>数字变量对下滑线的支持</strong>，方便阅读。如long tenSeconds = 10_000L;</p><p>注意：特殊地方不允许，如开头，小数点前后，f l等旁边。</p></li><li><p>switch对String的支持</p></li><li><p><strong>try-with-resource</strong>，不用在finally关闭对象。如io流打开，一般需要关闭。</p></li><li><p>捕获多种异常，使用一个catch捕获多个异常，用 | 分割</p></li><li><p>创建泛型时类型推断</p></li></ul><h3 id="4-jdk8"><a href="#4-jdk8" class="headerlink" title="4.jdk8"></a>4.jdk8</h3><ul><li><p>Lambda表达式和函数式接口</p></li><li><p>接口的默认方法和静态方法</p></li><li><p>更好的类型推断</p><pre class="line-numbers language-java"><code class="language-java"><span class="token comment" spellcheck="true">// type inference类型推导</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TypeInference</span><span class="token operator">&lt;</span>T<span class="token operator">></span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// 表示该方法返回一个泛型</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token operator">&lt;</span>T<span class="token operator">></span> BaseResult<span class="token operator">&lt;</span>T<span class="token operator">></span> <span class="token function">result</span><span class="token punctuation">(</span>Class<span class="token operator">&lt;</span>T<span class="token operator">></span> c<span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">BaseResult</span><span class="token operator">&lt;</span>T<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">static</span>  <span class="token operator">&lt;</span>T<span class="token operator">></span> T <span class="token function">defaultValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> null<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> T <span class="token function">getOrDefault</span><span class="token punctuation">(</span>T value<span class="token punctuation">,</span> T defaultValue<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token punctuation">(</span>value <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token operator">?</span> value <span class="token operator">:</span> defaultValue<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        BaseResult<span class="token operator">&lt;</span>String<span class="token operator">></span> result <span class="token operator">=</span> TypeInference<span class="token punctuation">.</span><span class="token function">result</span><span class="token punctuation">(</span>String<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// 无需.&lt;String>result</span>        BaseResult<span class="token operator">&lt;</span>String<span class="token operator">></span> result1 <span class="token operator">=</span> TypeInference<span class="token punctuation">.</span>&lt;String<span class="token operator">></span><span class="token function">result</span><span class="token punctuation">(</span>String<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">final</span> TypeInference<span class="token operator">&lt;</span>String<span class="token operator">></span> typeInference <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TypeInference</span><span class="token operator">&lt;</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// 编译器会自动推导defaultValue方法返回的值是String类型。</span>        typeInference<span class="token punctuation">.</span><span class="token function">getOrDefault</span><span class="token punctuation">(</span><span class="token string">"22"</span><span class="token punctuation">,</span> TypeInference<span class="token punctuation">.</span><span class="token function">defaultValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">BaseResult</span><span class="token operator">&lt;</span>T<span class="token operator">></span> <span class="token punctuation">{</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul><ul><li><p>Optional</p></li><li><p>Streams</p></li><li><p>新的日期时间API</p></li><li><p>Nashorn JavaScript引擎，可以写脚本</p></li><li><p>Base64</p><pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Base64Test</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// Base64就是一种基于64个可打印字符来表示二进制数据的方法,可用于在HTTP环境下传递较长的标识信息</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        String text <span class="token operator">=</span> <span class="token string">"i am studying java8"</span><span class="token punctuation">;</span>        <span class="token keyword">final</span> String encoded <span class="token operator">=</span> Base64<span class="token punctuation">.</span><span class="token function">getEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">encodeToString</span><span class="token punctuation">(</span>text<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span>StandardCharsets<span class="token punctuation">.</span>UTF_8<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>encoded<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">final</span> String decoded <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>Base64<span class="token punctuation">.</span><span class="token function">getDecoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">decode</span><span class="token punctuation">(</span>encoded<span class="token punctuation">)</span><span class="token punctuation">,</span> StandardCharsets<span class="token punctuation">.</span>UTF_8<span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>decoded<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>并行数组</p></li></ul><h1 id="二、lambda表达式"><a href="#二、lambda表达式" class="headerlink" title="二、lambda表达式"></a>二、lambda表达式</h1><h3 id="1-理解lambda"><a href="#1-理解lambda" class="headerlink" title="1. 理解lambda"></a>1. 理解lambda</h3><ul><li><p>命令式编程和声明式编程</p></li><li><p>什么是函数式？</p></li><li><p>行为参数化：就是一个方法接受多个不同的行为作为参数，并在内部使用它们，完成不同行为的能力。</p><ul><li>需求变更</li><li>Github项目筛选</li><li>更高层次抽象</li></ul></li><li><p>基本语法：</p><p>(parameters) -&gt; expression 自带return，后面跟表达式</p><p>(parameters) -&gt; { statements; } 不带return 需要手动设置，后面跟语句</p><p>需要认识到，parameters相当于是匿名内部类唯一方法的方法参数，后面的expression或statements相当于是匿名内部类唯一方法的方法体。</p><p>lambda表达式作为函数参数时，该函数原型对应lambda表达式的参数类型是一个函数式接口。</p><p>lambda表达式整体可以看做是函数式接口的实现。</p></li></ul><h3 id="2-初尝lambda"><a href="#2-初尝lambda" class="headerlink" title="2. 初尝lambda"></a>2. 初尝lambda</h3><ul><li>java8自带一些常用的函数式接口：Predicate<t>（断言）、Function&lt;T,R&gt;（映射）、Supplier<t>（创建对象）、Consumer<t> （消费对象）和 BinaryOperator<t>等</t></t></t></t></li></ul><h3 id="3-lambda进阶"><a href="#3-lambda进阶" class="headerlink" title="3. lambda进阶"></a>3. lambda进阶</h3><ul><li><p>方法引用：（3种）</p><ul><li>指向静态方法的方法引用。形式：类名::方法名</li><li>指向现有对象的实例方法的方法引用。形式：实例名::方法名</li><li>类::实例方法名</li></ul></li><li><p>构造函数引用：形式：类名::new（1种）</p></li><li><p>数组引用（1种）</p><pre class="line-numbers language-java"><code class="language-java">Function<span class="token operator">&lt;</span>Integer<span class="token punctuation">,</span> String<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">></span> fun <span class="token operator">=</span> x <span class="token operator">-</span><span class="token operator">></span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">;</span>Function<span class="token operator">&lt;</span>Integer<span class="token punctuation">,</span> String<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">></span> fun1 <span class="token operator">=</span> String<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">:</span><span class="token operator">:</span><span class="token keyword">new</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 数组引用</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> strs <span class="token operator">=</span> fun<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li><li><p>lambda表达式有异常</p><p>注意：任何函数式接口都不允许抛出受检异常。即普通异常。</p><p>异常分普通异常如IOException和运行时异常RuntimeException</p><p>遇到普通异常如何处理？ 要么catch内处理它，要么抛出RuntimeException；</p></li><li><p>类型检查</p><pre class="line-numbers language-java"><code class="language-java"><span class="token comment" spellcheck="true">// 代码类型检查过程</span>List<span class="token operator">&lt;</span>Student<span class="token operator">></span> students <span class="token operator">=</span> <span class="token function">filter</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> <span class="token punctuation">(</span>Student s<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> s<span class="token punctuation">.</span><span class="token function">getGrade</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">90</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// 1</span><span class="token function">filter</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> <span class="token punctuation">(</span>Student s<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> s<span class="token punctuation">.</span><span class="token function">getGrade</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">90</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// 2</span><span class="token function">filter</span><span class="token punctuation">(</span>List<span class="token operator">&lt;</span>Student<span class="token operator">></span> data<span class="token punctuation">,</span> Predicate<span class="token operator">&lt;</span>Student<span class="token operator">></span> predicate<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// 3</span>目标类型<span class="token comment" spellcheck="true">// 4</span><span class="token keyword">boolean</span> <span class="token function">test</span><span class="token punctuation">(</span>Student student<span class="token punctuation">)</span><span class="token punctuation">;</span>即：Student <span class="token operator">-</span><span class="token operator">></span> <span class="token keyword">boolean</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>编码实践</p></li><li><p>lambda小结</p></li></ul><h1 id="三、默认方法"><a href="#三、默认方法" class="headerlink" title="三、默认方法"></a>三、默认方法</h1><ul><li>兼容旧的API：需求：接口添加新方法。</li><li>接口默认方法</li><li>接口静态方法，可以实现抽象工厂类似功能</li><li>多实现冲突解决<ul><li>类中方法优先级最高。类或父类中声明的方法的优先级高于任何声明为默认方法的优先级。</li><li>如无法依据第一条进行判断，那么子接口的优先级更高。</li><li>如果还是无法判断，继承了多个接口的类必须通过显示覆盖和调用期望的方法，显示选择使用哪一个默认方法的实现。</li></ul></li><li>小结</li></ul><h1 id="四、Optional"><a href="#四、Optional" class="headerlink" title="四、Optional"></a>四、Optional</h1><pre class="line-numbers language-java"><code class="language-java"><span class="token comment" spellcheck="true">/** * 为了解决空指针异常，在Java8之前需要使用if-else这样的语句去防止空指针异常， * 而在Java8就可以使用Optional来解决。Optional可以理解成一个数据容器，甚至可以封装null， * 并且如果值存在调用isPresent()方法会返回true。 * 常用方法 * * 1. static &lt;T> Optional&lt;T> empty() 返回空的 Optional 实例。 * 2. static &lt;T> Optional&lt;T> of(T value) 返回一个指定非null值的Optional。 * 3. static &lt;T> Optional&lt;T> ofNullable(T value) 如果为非空，返回 Optional 描述的指定值，否则返回空的 Optional。 * * 4. T get()：如果在这个Optional中包含这个值，返回值，否则抛出异常：NoSuchElementException； * * 5. Optional&lt;T> filter(Predicate&lt;? super &lt;T> predicate)：如果值存在，并且这个值匹配给定的 predicate，返回一个Optional用以描述这个值，否则返回一个空的Optional； * * 6. &lt;U> Optional&lt;U> flatMap(Function&lt;? super T,Optional&lt;U>> mapper)：如果值存在，返回基于Optional包含的映射方法的值，否则返回一个空的Optional； * 7. &lt;U>Optional&lt;U> map(Function&lt;? super T,? extends U> mapper)：如果存在该值，则对其执行调用映射函数得到返回值，如果返回非null，返回一个Optional描述结果； * * 8. void ifPresent(Consumer&lt;? super T> consumer)：如果值存在则使用该值调用 consumer , 否则不做任何事情； * 9. boolean isPresent()：如果值存在则方法会返回true，否则返回 false； * * * 10. T orElse(T other)：如果存在该值，返回值， 否则返回 other； * 11. T orElseGet(Supplier&lt;? extends T> other)：如果存在该值，返回值， 否则触发 other，并返回 other 调用的结果； * 12. &lt;X extends Throwable> T orElseThrow(Supplier&lt;? extends X> exceptionSupplier)：如果存在该值，返回包含的值，否则抛出由 Supplier 继承的异常； * * 13. int hashCode()：返回存在值的哈希码，如果值不存在 返回 0； * 14. boolean equals(Object obj)：判断其他对象是否等于 Optional； * 15. String toString()：返回一个Optional的非空字符串，用来调试 * * Optional并不鸡肋，用得好，才会好。https://blog.csdn.net/shadow_zed/article/details/80034376 */</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OptionalTest</span> <span class="token punctuation">{</span>    <span class="token keyword">private</span> String <span class="token function">getUserName0</span><span class="token punctuation">(</span>User user<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> user<span class="token punctuation">.</span><span class="token function">getUserName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// user可能为空</span>    <span class="token punctuation">}</span>    <span class="token keyword">private</span> String <span class="token function">getUserName1</span><span class="token punctuation">(</span>User user<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment" spellcheck="true">// java8之前</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>user <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> user<span class="token punctuation">.</span><span class="token function">getUserName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> null<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">private</span> String <span class="token function">getUserName</span><span class="token punctuation">(</span>User user<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment" spellcheck="true">// java8</span>        Optional<span class="token operator">&lt;</span>User<span class="token operator">></span> userOptional <span class="token operator">=</span> Optional<span class="token punctuation">.</span><span class="token function">ofNullable</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> userOptional<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>User<span class="token operator">:</span><span class="token operator">:</span>getUserName<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">orElse</span><span class="token punctuation">(</span>null<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token punctuation">{</span>        <span class="token keyword">private</span> String userName<span class="token punctuation">;</span>        <span class="token keyword">public</span> <span class="token function">User</span><span class="token punctuation">(</span>String userName<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">this</span><span class="token punctuation">.</span>userName <span class="token operator">=</span> userName<span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">public</span> String <span class="token function">getUserName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> userName<span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// 1 创建Optional</span>        <span class="token comment" spellcheck="true">// 通过静态工厂方法Optional.empty，创建一个空的Optional对象；</span>        Optional<span class="token operator">&lt;</span>Object<span class="token operator">></span> optional <span class="token operator">=</span> Optional<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// 使用静态工厂方法Optional.ofNullable，你可以创建一个允许null值的Optional对象。</span>        Optional<span class="token operator">&lt;</span>Object<span class="token operator">></span> optional1 <span class="token operator">=</span> Optional<span class="token punctuation">.</span><span class="token function">ofNullable</span><span class="token punctuation">(</span>null<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// 如果value为null的话，立即抛出NullPointerException；</span>        Optional<span class="token operator">&lt;</span>String<span class="token operator">></span> optional2 <span class="token operator">=</span> Optional<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token string">"12"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="五、Stream"><a href="#五、Stream" class="headerlink" title="五、Stream"></a>五、Stream</h1><h3 id="1-理解Stream"><a href="#1-理解Stream" class="headerlink" title="1. 理解Stream"></a>1. 理解Stream</h3><ul><li>什么是流？流是Java8引入的全新概念，它用来处理集合中的数据，暂且可以把它理解为一种高级集合</li><li>集合与流</li><li>内部迭代和外部迭代：采用内部迭代方式 若要对集合进行处理，则需我们手写处理代码，这就叫做外部迭代。 而要对流进行处理，我们只需告诉流我们需要什么结果，处理过程由流自行完成，这就称为内部迭代。</li><li>中间操作和终端操作<ul><li>中间操作 当数据源中的数据上了流水线后，这个过程对数据进行的所有操作都称为“中间操作”。 中间操作仍然会返回一个流对象，因此多个中间操作可以串连起来形成一个流水线。</li><li>终端操作 当所有的中间操作完成后，若要将数据从流水线上拿下来，则需要执行终端操作。 终端操作将返回一个执行结果，这就是你想要的数据。</li></ul></li></ul><h3 id="2-使用流"><a href="#2-使用流" class="headerlink" title="2. 使用流"></a>2. 使用流</h3><pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">package</span> java8<span class="token punctuation">.</span>stream<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>io<span class="token punctuation">.</span>IOException<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>charset<span class="token punctuation">.</span>Charset<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>file<span class="token punctuation">.</span>Files<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>file<span class="token punctuation">.</span>Paths<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>Arrays<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>List<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>Optional<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>OptionalInt<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>stream<span class="token punctuation">.</span>Collectors<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>stream<span class="token punctuation">.</span>IntStream<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>stream<span class="token punctuation">.</span>Stream<span class="token punctuation">;</span><span class="token comment" spellcheck="true">/** * java8新特性：Stream 一种新的数据处理方式，结合lambda更简洁高效。可对数据进行筛选、排序以及聚合等操作。 * Stream中的元素在管道中经过中间操作（intermediate operation）的处理后，最后由最终操作（terminal operation）得到最终的结果。 * 数据源：是Stream的来源，可以是集合、数组、I/O channel等转换而成的Stream； * 基本操作：类似于SQL语句一样的操作，比如filter,map,reduce,find,match,sort等操作。 * 当我们操作一个流时，实际上会包含这样的执行过程： * 获取数据源-->转换成Stream-->执行操作，返回一个新的Stream-->再以新的Stream继续执行操作--->直至最后操作输出最终结果。 */</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StreamTest</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// ===============  创建Stream   ==================</span>        String<span class="token punctuation">[</span><span class="token punctuation">]</span> strArr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span><span class="token string">"a"</span><span class="token punctuation">,</span> <span class="token string">"b"</span><span class="token punctuation">,</span> <span class="token string">"c"</span><span class="token punctuation">}</span><span class="token punctuation">;</span>        List<span class="token operator">&lt;</span>String<span class="token operator">></span> list <span class="token operator">=</span> Arrays<span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span>strArr<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// 1. 使用集合Collection和数组Arrays的方法。</span>        Stream<span class="token operator">&lt;</span>String<span class="token operator">></span> stream <span class="token operator">=</span> list<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 集合</span>        Stream<span class="token operator">&lt;</span>String<span class="token operator">></span> parallelStream <span class="token operator">=</span> list<span class="token punctuation">.</span><span class="token function">parallelStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//相较于串行流，并行流能够大大提升执行效率</span>        Stream<span class="token operator">&lt;</span>String<span class="token operator">></span> stream1 <span class="token operator">=</span> Arrays<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span>strArr<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 数组</span>        <span class="token comment" spellcheck="true">// 2. 使用Stream中提供的静态方法</span>        Stream<span class="token operator">&lt;</span>String<span class="token operator">></span> stream2 <span class="token operator">=</span> Stream<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>strArr<span class="token punctuation">)</span><span class="token punctuation">;</span>        Stream<span class="token operator">&lt;</span>Double<span class="token operator">></span> stream3 <span class="token operator">=</span> Stream<span class="token punctuation">.</span><span class="token function">generate</span><span class="token punctuation">(</span>Math<span class="token operator">:</span><span class="token operator">:</span>random<span class="token punctuation">)</span><span class="token punctuation">;</span>        Stream<span class="token operator">&lt;</span>Object<span class="token operator">></span> stream4 <span class="token operator">=</span> Stream<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        Stream<span class="token operator">&lt;</span>Integer<span class="token operator">></span> iterate <span class="token operator">=</span> Stream<span class="token punctuation">.</span><span class="token function">iterate</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> i <span class="token operator">-</span><span class="token operator">></span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 无限流</span>        <span class="token comment" spellcheck="true">// 3. 其他方法</span>        <span class="token comment" spellcheck="true">//IntStream ints = Random.ints();</span>        <span class="token comment" spellcheck="true">//BitSet.stream();</span>        <span class="token comment" spellcheck="true">//Pattern.splitAsStream(java.lang.CharSequence);</span>        <span class="token comment" spellcheck="true">//JarFile.stream();</span>        <span class="token comment" spellcheck="true">//BufferedReader.lines();</span>        <span class="token comment" spellcheck="true">// Java7简化了IO操作，把打开IO操作放在try后的括号中即可省略关闭IO的代码。</span>        <span class="token keyword">try</span><span class="token punctuation">(</span>Stream lines <span class="token operator">=</span> Files<span class="token punctuation">.</span><span class="token function">lines</span><span class="token punctuation">(</span>Paths<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"文件路径名"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Charset<span class="token punctuation">.</span><span class="token function">defaultCharset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token comment" spellcheck="true">//可对lines做一些操作</span>        <span class="token punctuation">}</span><span class="token keyword">catch</span><span class="token punctuation">(</span>IOException e<span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token punctuation">}</span>        <span class="token comment" spellcheck="true">// ===============  Stream操作   ==================</span>        <span class="token comment" spellcheck="true">//Intermediate（中间操作）:中间操作是指对流中数据元素做出相应转换或操作后依然返回为一个流Stream，</span>        <span class="token comment" spellcheck="true">// 仍然可以供下一次流操作使用。常用的有：map (mapToInt, flatMap 等)、</span>        <span class="token comment" spellcheck="true">// filter、 distinct、 sorted、 peek、 limit、 skip。</span>        <span class="token comment" spellcheck="true">//Termial（结束操作）：是指最终对Stream做出聚合操作，输出结果。</span>        <span class="token comment" spellcheck="true">// filter：对Stream中元素进行过滤</span>        <span class="token comment" spellcheck="true">// filter 函数接收一个Lambda表达式作为参数，该表达式返回boolean，在执行过程中，流将元素逐一输送给filter，并筛选出执行结果为true的元素</span>        <span class="token keyword">long</span> count <span class="token operator">=</span> stream<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>String<span class="token operator">:</span><span class="token operator">:</span>isEmpty<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// map：对Stream中元素按照指定规则映射成另一个元素 map方法是一对一的关系，</span>        <span class="token comment" spellcheck="true">// 如果是一对多的关系的话就需要使用flatmap方法。</span>        <span class="token comment" spellcheck="true">// flatmap 扁平化处理流，即对第二层的结构每个元素处理然后汇集成一个stream，flatmap需要集合的stream操作作为参数。</span>        <span class="token comment" spellcheck="true">// lists.stream().flatMap(Collection::stream).collect(Collectors.toList()); 将一个list中多个子list合并为一个list。</span>        stream1<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>str <span class="token operator">-</span><span class="token operator">></span> str <span class="token operator">+</span> <span class="token string">"_map"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>System<span class="token punctuation">.</span>out<span class="token operator">:</span><span class="token operator">:</span>println<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// concat：对流进行合并操作</span>        <span class="token comment" spellcheck="true">// concat方法将两个Stream连接在一起，合成一个Stream。</span>        <span class="token comment" spellcheck="true">// 若两个输入的Stream都是排序的，则新Stream也是排序的；</span>        <span class="token comment" spellcheck="true">// 若输入的Stream中任何一个是并行的，则新的Stream也是并行的；</span>        <span class="token comment" spellcheck="true">// 若关闭新的Stream时，原两个输入的Stream都将执行关闭处理。</span>        Stream<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>Stream<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Stream<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>System<span class="token punctuation">.</span>out<span class="token operator">:</span><span class="token operator">:</span>println<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// distinct：对流进行去重操作</span>        Stream<span class="token operator">&lt;</span>String<span class="token operator">></span> stream5 <span class="token operator">=</span> Stream<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">,</span> <span class="token string">"a"</span><span class="token punctuation">,</span> <span class="token string">"b"</span><span class="token punctuation">,</span> <span class="token string">"c"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        stream5<span class="token punctuation">.</span><span class="token function">distinct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>System<span class="token punctuation">.</span>out<span class="token operator">:</span><span class="token operator">:</span>println<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// limit：限制流中元素的个数</span>        Stream<span class="token operator">&lt;</span>String<span class="token operator">></span> stream6 <span class="token operator">=</span> Stream<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">,</span> <span class="token string">"a"</span><span class="token punctuation">,</span> <span class="token string">"b"</span><span class="token punctuation">,</span> <span class="token string">"c"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        stream6<span class="token punctuation">.</span><span class="token function">limit</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>System<span class="token punctuation">.</span>out<span class="token operator">:</span><span class="token operator">:</span>println<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// skip：跳过流中前几个元素</span>        Stream<span class="token operator">&lt;</span>String<span class="token operator">></span> stream7 <span class="token operator">=</span> Stream<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">,</span> <span class="token string">"a"</span><span class="token punctuation">,</span> <span class="token string">"b"</span><span class="token punctuation">,</span> <span class="token string">"c"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        stream7<span class="token punctuation">.</span><span class="token function">skip</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>System<span class="token punctuation">.</span>out<span class="token operator">:</span><span class="token operator">:</span>println<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// peek：对流中每一个元素依次进行操作，类似于forEach操作</span>        List<span class="token operator">&lt;</span>String<span class="token operator">></span> a <span class="token operator">=</span> Stream<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token string">"one"</span><span class="token punctuation">,</span> <span class="token string">"two"</span><span class="token punctuation">,</span> <span class="token string">"three"</span><span class="token punctuation">,</span> <span class="token string">"four"</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>e <span class="token operator">-</span><span class="token operator">></span> e<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">3</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">peek</span><span class="token punctuation">(</span>e <span class="token operator">-</span><span class="token operator">></span> System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Filtered value: "</span> <span class="token operator">+</span> e<span class="token punctuation">)</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>String<span class="token operator">:</span><span class="token operator">:</span>toUpperCase<span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">peek</span><span class="token punctuation">(</span>e <span class="token operator">-</span><span class="token operator">></span> System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Mapped value: "</span> <span class="token operator">+</span> e<span class="token punctuation">)</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span>Collectors<span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 每个元素依次执行一遍</span>        <span class="token comment" spellcheck="true">// 流的收集器Collectors可用于将流元素归约和汇总为一个值、元素分组、元素分区。</span>        <span class="token comment" spellcheck="true">// sorted：对流中元素进行排序，可以通过sorted(Comparator&lt;? super T> comparator)自定义比较规则</span>        Stream<span class="token operator">&lt;</span>Integer<span class="token operator">></span> stream8 <span class="token operator">=</span> Stream<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        stream8<span class="token punctuation">.</span><span class="token function">sorted</span><span class="token punctuation">(</span>Integer<span class="token operator">:</span><span class="token operator">:</span>compareTo<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>System<span class="token punctuation">.</span>out<span class="token operator">:</span><span class="token operator">:</span>println<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// match：检查流中元素是否匹配指定的匹配规则</span>        <span class="token comment" spellcheck="true">// allMatch：Stream 中全部元素符合传入的 predicate，返回 true；</span>        <span class="token comment" spellcheck="true">// anyMatch：Stream 中只要有一个元素符合传入的 predicate，返回 true；</span>        <span class="token comment" spellcheck="true">// noneMatch：Stream 中没有一个元素符合传入的 predicate，返回 true。</span>        Stream<span class="token operator">&lt;</span>Integer<span class="token operator">></span> stream9 <span class="token operator">=</span> Stream<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">boolean</span> match <span class="token operator">=</span> stream9<span class="token punctuation">.</span><span class="token function">allMatch</span><span class="token punctuation">(</span>integer <span class="token operator">-</span><span class="token operator">></span> integer <span class="token operator">></span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>match<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// 获取任一元素findAny findAny能够从流中随便选一个元素出来，它返回一个Optional类型的元素</span>        Optional<span class="token operator">&lt;</span>Integer<span class="token operator">></span> integerAny <span class="token operator">=</span> Stream<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">findAny</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// 获取第一个元素findFirst</span>        Optional<span class="token operator">&lt;</span>Integer<span class="token operator">></span> integerFirst <span class="token operator">=</span> Stream<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">findFirst</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// ===============  结束操作   ==================</span>        <span class="token comment" spellcheck="true">// Collectors常见规约方法总结 https://blog.csdn.net/u013291394/article/details/52662761</span>        <span class="token comment" spellcheck="true">// 重构和定制收集器Collectors https://blog.csdn.net/io_field/article/details/54971555</span>        <span class="token comment" spellcheck="true">// count：统计Stream中元素的个数 见上filter操作</span>        <span class="token comment" spellcheck="true">// max/min：找出流中最大或者最小的元素</span>        Stream<span class="token operator">&lt;</span>Integer<span class="token operator">></span> stream10 <span class="token operator">=</span> Stream<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>stream10<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span>Integer<span class="token operator">:</span><span class="token operator">:</span>compareTo<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// forEach 见上，用于循环</span>        <span class="token comment" spellcheck="true">// reduce https://blog.csdn.net/IO_Field/article/details/54971679</span>        <span class="token comment" spellcheck="true">// 归约是将集合中的所有元素经过指定运算，折叠成一个元素输出，如：求最值、平均数等，这些操作都是将一个集合的元素折叠成一个元素输出。</span>        <span class="token comment" spellcheck="true">// 在流中，reduce函数能实现归约。 reduce函数接收两个参数：初始值, 进行归约操作的Lambda表达式</span>        <span class="token keyword">int</span> sum <span class="token operator">=</span> Stream<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>i1<span class="token punctuation">,</span> i2<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> i1 <span class="token operator">+</span> i2<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 求和</span>        <span class="token keyword">int</span> sum1 <span class="token operator">=</span> Stream<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> Integer<span class="token operator">:</span><span class="token operator">:</span>sum<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 方法引用，类似有求min,max操作</span>        <span class="token comment" spellcheck="true">// 数值流使用</span>        <span class="token comment" spellcheck="true">// 采用reduce进行数值操作会涉及到基本数值类型和引用数值类型之间的装箱、拆箱操作，因此效率较低。</span>        <span class="token comment" spellcheck="true">// 当流操作为纯数值操作时，使用数值流能获得较高的效率</span>        <span class="token comment" spellcheck="true">// 将普通流转换成数值流</span>        <span class="token comment" spellcheck="true">// StreamAPI提供了三种数值流：IntStream、DoubleStream、LongStream，</span>        <span class="token comment" spellcheck="true">// 也提供了将普通流转换成数值流的三种方法：mapToInt、mapToDouble、mapToLong。</span>        IntStream intStream <span class="token operator">=</span> Stream<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token string">"1"</span><span class="token punctuation">,</span> <span class="token string">"2"</span><span class="token punctuation">,</span> <span class="token string">"3"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">mapToInt</span><span class="token punctuation">(</span>Integer<span class="token operator">:</span><span class="token operator">:</span>parseInt<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">int</span> sum2 <span class="token operator">=</span> Stream<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token string">"1"</span><span class="token punctuation">,</span> <span class="token string">"2"</span><span class="token punctuation">,</span> <span class="token string">"3"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">mapToInt</span><span class="token punctuation">(</span>Integer<span class="token operator">:</span><span class="token operator">:</span>parseInt<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 数值计算 max, min, sun等</span>        <span class="token comment" spellcheck="true">// 由于数值流可能为空，并且给空的数值流计算最大值是没有意义的，因此max函数返回OptionalInt，</span>        OptionalInt max <span class="token operator">=</span> Stream<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token string">"1"</span><span class="token punctuation">,</span> <span class="token string">"2"</span><span class="token punctuation">,</span> <span class="token string">"3"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">mapToInt</span><span class="token punctuation">(</span>Integer<span class="token operator">:</span><span class="token operator">:</span>parseInt<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// 它是Optional的一个子类，能够判断流是否为空，并对流为空的情况作相应的处理。</span>        <span class="token comment" spellcheck="true">// 此外，mapToInt、mapToDouble、mapToLong进行数值操作后的返回结果分别为：OptionalInt、OptionalDouble、OptionalLong</span>        <span class="token comment" spellcheck="true">// 收集器用来将经过筛选、映射的流进行最后的整理，可以使得最后的结果以不同的形式展现。</span>        <span class="token comment" spellcheck="true">// collect 方法即为收集器，它接收 Collector 接口的实现作为具体收集器的收集方法。</span>        <span class="token comment" spellcheck="true">// Collector 接口提供了很多默认实现的方法，我们可以直接使用它们格式化流的结果；也可以自定义 Collector 接口的实现，从而定制自己的收集器。</span>        <span class="token comment" spellcheck="true">// Collectors.reducing();  自定义规约</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="3-Collector-收集"><a href="#3-Collector-收集" class="headerlink" title="3.  Collector 收集"></a>3.  Collector 收集</h3><p>收集器用来将经过筛选、映射的流进行最后的整理，可以使得最后的结果以不同的形式展现。 <code>collect</code> 方法即为收集器，它接收 <code>Collector</code> 接口的实现作为具体收集器的收集方法。 <code>Collector</code> 接口提供了很多默认实现的方法，我们可以直接使用它们格式化流的结果；也可以自定义 <code>Collector</code> 接口的实现，从而定制自己的收集器。</p><p><strong>归约</strong>：流由一个个元素组成，归约就是将一个个元素“折叠”成一个值，如求和、求最值、求平均值都是归约操作。</p><p><strong>一般性归约</strong>：若你需要自定义一个归约操作，那么需要使用 <code>Collectors.reducing</code> 函数，该函数接收三个参数：</p><ul><li>第一个参数为归约的初始值</li><li>第二个参数为归约操作进行的字段</li><li>第三个参数为归约操作的过程</li></ul><p><strong>汇总</strong>：Collectors类专门为汇总提供了一个工厂方法：<code>Collectors.summingInt</code>。 它可接受一 个把对象映射为求和所需int的函数，并返回一个收集器；该收集器在传递给普通的 <code>collect</code> 方法后即执行我们需要的汇总操作。</p><p><strong>分组</strong>：数据分组是一种更自然的分割数据操作，分组就是将流中的元素按照指定类别进行划分，类似于SQL语句中的 <code>GROUPBY</code>。</p><p><strong>多级分组</strong>：多级分组可以支持在完成一次分组后，分别对每个小组再进行分组。 使用具有两个参数的 <code>groupingBy</code> 重载方法即可实现多级分组。</p><ul><li>第一个参数：一级分组的条件</li><li>第二个参数：一个新的 <code>groupingBy</code> 函数，该函数包含二级分组的条件</li></ul><p><strong>Collectors 类的静态工厂方法</strong></p><table><thead><tr><th>返回类型</th><th>工厂方法</th><th>用途</th><th>示例</th></tr></thead><tbody><tr><td><code>List&lt;T&gt;</code></td><td><code>toList</code></td><td>把流中所有项目收集到一个 List</td><td><code>List&lt;Project&gt; projects = projectStream.collect(toList());</code></td></tr><tr><td><code>Set&lt;T&gt;</code></td><td><code>toSet</code></td><td>把流中所有项目收集到一个 Set，删除重复项</td><td><code>Set&lt;Project&gt; projects = projectStream.collect(toSet());</code></td></tr><tr><td><code>Collection&lt;T&gt;</code></td><td><code>toCollection</code></td><td>把流中所有项目收集到给定的供应源创建的集合</td><td><code>Collection&lt;Project&gt; projects = projectStream.collect(toCollection(), ArrayList::new);</code></td></tr><tr><td><code>Long</code></td><td><code>counting</code></td><td>计算流中元素的个数</td><td><code>long howManyProjects = projectStream.collect(counting());</code></td></tr><tr><td><code>Integer</code></td><td><code>summingInt</code></td><td>对流中项目的一个整数属性求和</td><td><code>int totalStars = projectStream.collect(summingInt(Project::getStars));</code></td></tr><tr><td><code>Double</code></td><td><code>averagingInt</code></td><td>计算流中项目 Integer 属性的平均值</td><td><code>double avgStars = projectStream.collect(averagingInt(Project::getStars));</code></td></tr><tr><td><code>IntSummaryStatistics</code></td><td><code>summarizingInt</code></td><td>收集关于流中项目 Integer 属性的统计值，例如最大、最小、 总和与平均值</td><td><code>IntSummaryStatistics projectStatistics = projectStream.collect(summarizingInt(Project::getStars));</code></td></tr><tr><td><code>String</code></td><td><code>joining</code></td><td>连接对流中每个项目调用 toString 方法所生成的字符串</td><td><code>String shortProject = projectStream.map(Project::getName).collect(joining(&quot;, &quot;));</code></td></tr><tr><td><code>Optional&lt;T&gt;</code></td><td><code>maxBy</code></td><td>按照给定比较器选出的最大元素的 Optional， 或如果流为空则为 Optional.empty()</td><td><code>Optional&lt;Project&gt; fattest = projectStream.collect(maxBy(comparingInt(Project::getStars)));</code></td></tr><tr><td><code>Optional&lt;T&gt;</code></td><td><code>minBy</code></td><td>按照给定比较器选出的最小元素的 Optional， 或如果流为空则为 Optional.empty()</td><td><code>Optional&lt;Project&gt; fattest = projectStream.collect(minBy(comparingInt(Project::getStars)));</code></td></tr><tr><td>归约操作产生的类型</td><td><code>reducing</code></td><td>从一个作为累加器的初始值开始，利用 BinaryOperator 与流中的元素逐个结合，从而将流归约为单个值</td><td><code>int totalStars = projectStream.collect(reducing(0, Project::getStars, Integer::sum));</code></td></tr><tr><td>转换函数返回的类型</td><td><code>collectingAndThen</code></td><td>包含另一个收集器，对其结果应用转换函数</td><td><code>int howManyProjects = projectStream.collect(collectingAndThen(toList(), List::size));</code></td></tr><tr><td><code>Map&lt;K, List&lt;T&gt;&gt;</code></td><td><code>groupingBy</code></td><td>根据项目的一个属性的值对流中的项目作问组，并将属性值作 为结果 Map 的键</td><td><code>Map&lt;String,List&lt;Project&gt;&gt; projectByLanguage = projectStream.collect(groupingBy(Project::getLanguage));</code></td></tr><tr><td><code>Map&lt;Boolean,List&lt;T&gt;&gt;</code></td><td><code>partitioningBy</code></td><td>根据对流中每个项目应用断言的结果来对项目进行分区</td><td><code>Map&lt;Boolean,List&lt;Project&gt;&gt; vegetarianDishes = projectStream.collect(partitioningBy(Project::isVegetarian));</code></td></tr></tbody></table><p><strong>转换类型</strong><br>有一些收集器可以生成其他集合。比如前面已经见过的 <code>toList</code>，生成了 <code>java.util.List</code> 类的实例。 还有 <code>toSet</code> 和 <code>toCollection</code>，分别生成 <code>Set</code> 和 <code>Collection</code> 类的实例。 到目前为止， 我已经讲了很多流上的链式操作，但总有一些时候，需要最终生成一个集合——比如：</p><ul><li>已有代码是为集合编写的，因此需要将流转换成集合传入；</li><li>在集合上进行一系列链式操作后，最终希望生成一个值；</li><li>写单元测试时，需要对某个具体的集合做断言。</li></ul><p>使用 <code>toCollection</code>，用定制的集合收集元素</p><pre><code>stream.collect(toCollection(TreeSet::new));</code></pre><p>还可以利用收集器让流生成一个值。 <code>maxBy</code> 和 <code>minBy</code> 允许用户按某种特定的顺序生成一个值。</p><p><strong>数据分区</strong></p><p>分区是分组的特殊情况：由一个断言（返回一个布尔值的函数）作为分类函数，它称分区函数。 分区函数返回一个布尔值，这意味着得到的分组 <code>Map</code> 的键类型是 <code>Boolean</code>，于是它最多可以分为两组: true是一组，false是一组。</p><p>分区的好处在于保留了分区函数返回true或false的两套流元素列表。</p><p><strong>并行流</strong></p><p>并行流就是一个把内容分成多个数据块，并用不不同的线程分别处理每个数据块的流。最后合并每个数据块的计算结果。</p><p>将一个顺序执行的流转变成一个并发的流只要调用 <code>parallel()</code> 方法</p><pre><code>public static long parallelSum(long n){    return Stream.iterate(1L, i -&gt; i +1).limit(n).parallel().reduce(0L,Long::sum);}</code></pre><p>将一个并发流转成顺序的流只要调用 <code>sequential()</code> 方法</p><pre><code>stream.parallel().filter(...).sequential().map(...).parallel().reduce();</code></pre><p>这两个方法可以多次调用，只有最后一个调用决定这个流是顺序的还是并发的。</p><p>并发流使用的默认线程数等于你机器的处理器核心数。</p><p>通过这个方法可以修改这个值，这是全局属性。</p><pre><code>System.setProperty(&quot;java.util.concurrent.ForkJoinPool.common.parallelism&quot;, &quot;12&quot;);</code></pre><p>并非使用多线程并行流处理数据的性能一定高于单线程顺序流的性能，因为性能受到多种因素的影响。 如何高效使用并发流的一些建议：</p><ol><li>如果不确定， 就自己测试。</li><li><strong>尽量使用基本类型的流 IntStream, LongStream, DoubleStream</strong></li><li>有些操作使用并发流的性能会比顺序流的性能更差，比如limit，findFirst，<strong>依赖元素顺序的操作在并发流中是极其消耗性能的</strong>。findAny的性能就会好很多，应为不依赖顺序。</li><li>考虑流中计算的性能(Q)和操作的性能(N)的对比, Q表示单个处理所需的时间，N表示需要处理的数量，如果Q的值越大, 使用并发流的性能就会越高。</li><li>数据量不大时使用并发流，性能得不到提升。</li><li>考虑数据结构：并发流需要对数据进行分解，不同的数据结构被分解的性能时不一样的。</li></ol><p><strong>流的数据源和可分解性</strong></p><table><thead><tr><th>源</th><th>可分解性</th></tr></thead><tbody><tr><td><code>ArrayList</code></td><td>非常好</td></tr><tr><td><code>LinkedList</code></td><td>差</td></tr><tr><td><code>IntStream.range</code></td><td>非常好</td></tr><tr><td><code>Stream.iterate</code></td><td>差</td></tr><tr><td><code>HashSet</code></td><td>好</td></tr><tr><td><code>TreeSet</code></td><td>好</td></tr></tbody></table><p><strong>流的特性以及中间操作对流的修改都会对数据对分解性能造成影响。 比如固定大小的流在任务分解的时候就可以平均分配，但是如果有filter操作，那么流就不能预先知道在这个操作后还会剩余多少元素。</strong></p><p><strong>考虑终端操作的性能：如果终端操作在合并并发流的计算结果时的性能消耗太大，那么使用并发流提升的性能就会得不偿失。</strong></p><h1 id="六、新的时间和日期API"><a href="#六、新的时间和日期API" class="headerlink" title="六、新的时间和日期API"></a>六、新的时间和日期API</h1><pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DateTimeTest</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Test</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testZoneId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// ZoneId</span>        ZoneId shanghaiZoneId <span class="token operator">=</span> ZoneId<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token string">"Asia/Shanghai"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// of() 方法接收一个“区域/城市”的字符串作为参数</span>        ZoneId systemZoneId <span class="token operator">=</span> ZoneId<span class="token punctuation">.</span><span class="token function">systemDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 获取系统默认时区</span>        Set<span class="token operator">&lt;</span>String<span class="token operator">></span> zoneIds <span class="token operator">=</span> ZoneId<span class="token punctuation">.</span><span class="token function">getAvailableZoneIds</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 获取所有合法的“区域/城市”字符串</span>        ZoneId oldToNewZoneId <span class="token operator">=</span> TimeZone<span class="token punctuation">.</span><span class="token function">getDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toZoneId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 旧的时区类转新的时区类</span>        <span class="token comment" spellcheck="true">// ZonedDateTime</span>        LocalDateTime localDateTime <span class="token operator">=</span> LocalDateTime<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        ZonedDateTime zonedDateTime <span class="token operator">=</span> ZonedDateTime<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>localDateTime<span class="token punctuation">,</span> shanghaiZoneId<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// 2021-02-07T18:30:18.444+08:00[Asia/Shanghai] 前面是localDateTime，后面是时区</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"ZonedDateTime: "</span> <span class="token operator">+</span> zonedDateTime<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// OffsetDateTime</span>        ZoneOffset zoneOffset <span class="token operator">=</span> ZoneOffset<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token string">"+09:00"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        OffsetDateTime offsetDateTime <span class="token operator">=</span> OffsetDateTime<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>localDateTime<span class="token punctuation">,</span> zoneOffset<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// 2021-02-07T18:35:16.417+09:00</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"OffsetDateTime: "</span> <span class="token operator">+</span> offsetDateTime<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">/**     * nstant类在Java日期与时间功能中，表示了时间线上一个确切的点，     * 定义为距离初始时间的时间差（初始时间为GMT 1970年1月1日00:00）     * 经测量一天有86400秒，从初始时间开始不断向前移动。     */</span>    <span class="token annotation punctuation">@Test</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testInstant</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        Instant instant <span class="token operator">=</span> Instant<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">long</span> seconds <span class="token operator">=</span> instant<span class="token punctuation">.</span><span class="token function">getEpochSecond</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 距离初始时间的秒钟数</span>        <span class="token keyword">int</span> nanos <span class="token operator">=</span> instant<span class="token punctuation">.</span><span class="token function">getNano</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 在当前一秒内的第几纳秒 不会超过999,999,999</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"instant: "</span> <span class="token operator">+</span> instant <span class="token operator">+</span> <span class="token string">"  seconds: "</span> <span class="token operator">+</span> seconds <span class="token operator">+</span> <span class="token string">" nanos: "</span> <span class="token operator">+</span> nanos<span class="token punctuation">)</span><span class="token punctuation">;</span>        Instant plusSecond <span class="token operator">=</span> instant<span class="token punctuation">.</span><span class="token function">plusSeconds</span><span class="token punctuation">(</span>3L<span class="token punctuation">)</span><span class="token punctuation">;</span>        Instant minusSecond <span class="token operator">=</span> instant<span class="token punctuation">.</span><span class="token function">minusSeconds</span><span class="token punctuation">(</span>3L<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// 类似的还有毫秒（plusMillis），纳秒（plusNanos）</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"plusSeconds: "</span> <span class="token operator">+</span> plusSecond <span class="token operator">+</span> <span class="token string">" minusSecond: "</span> <span class="token operator">+</span> minusSecond<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">/**     * Clock类提供了访问当前日期和时间的方法，Clock是时区敏感的，可以用来取代 System.currentTimeMillis() 来获取当前的毫秒数。     * 某一个特定的时间点也可以使用Instant类来表示，Instant 类也可以用来创建老的 java.util.Date 对象。     */</span>    <span class="token annotation punctuation">@Test</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testClock</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        Clock clock <span class="token operator">=</span> Clock<span class="token punctuation">.</span><span class="token function">systemDefaultZone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">long</span> millis <span class="token operator">=</span> clock<span class="token punctuation">.</span><span class="token function">millis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 等价于System.currentTimeMillis()</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Clock.systemDefaultZone().millis: "</span> <span class="token operator">+</span> millis <span class="token operator">+</span>                <span class="token string">" \nSystem.currentTimeMills: "</span> <span class="token operator">+</span> System<span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        Instant instant <span class="token operator">=</span> clock<span class="token punctuation">.</span><span class="token function">instant</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        Date legacyDate <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>instant<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment" spellcheck="true">// legacy java.util.Date</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">/**     * LocalDate类是Java 8中日期时间功能里表示一个本地日期的类，它的日期是无时区属性的。 可以用来表示生日、节假日期等等。     * 这个类用于表示一个确切的日期，而不是这个日期所在的时间（如java.util.Date中的2000.01.01表示的实际是这一天的00:00这个瞬间）。     * LocalDate类位于java.time包下，人名叫java.time.LocalDate，创建出来的实例也是不可变对象，所以涉及它的计算方法将返回一个新的LocalDate。     */</span>    <span class="token annotation punctuation">@Test</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testLocalDate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        LocalDate localDate <span class="token operator">=</span> LocalDate<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 今天当日的 LocalDate 对象</span>        LocalDate localDate2 <span class="token operator">=</span> LocalDate<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token number">2018</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 创建出一个指定年月日的日期，并且没有时区信息</span>        <span class="token keyword">int</span>   year       <span class="token operator">=</span> localDate<span class="token punctuation">.</span><span class="token function">getYear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 年</span>        <span class="token keyword">int</span> month      <span class="token operator">=</span> localDate<span class="token punctuation">.</span><span class="token function">getMonth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 月</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Month.name: "</span> <span class="token operator">+</span> localDate<span class="token punctuation">.</span><span class="token function">getMonth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Month.getDisplayName: "</span> <span class="token operator">+</span> localDate<span class="token punctuation">.</span><span class="token function">getMonth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getDisplayName</span><span class="token punctuation">(</span>TextStyle<span class="token punctuation">.</span>FULL<span class="token punctuation">,</span> Locale<span class="token punctuation">.</span>CHINA<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">int</span>   dayOfMonth <span class="token operator">=</span> localDate<span class="token punctuation">.</span><span class="token function">getDayOfMonth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 日</span>        <span class="token keyword">int</span>   dayOfYear  <span class="token operator">=</span> localDate<span class="token punctuation">.</span><span class="token function">getDayOfYear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 一年中的第几天</span>        <span class="token keyword">int</span> dayOfWeek <span class="token operator">=</span> localDate<span class="token punctuation">.</span><span class="token function">getDayOfWeek</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 星期几</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"DayOfWeek().name: "</span> <span class="token operator">+</span> localDate<span class="token punctuation">.</span><span class="token function">getDayOfWeek</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"DayOfWeek().getDisplayName: "</span> <span class="token operator">+</span> localDate<span class="token punctuation">.</span><span class="token function">getDayOfWeek</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getDisplayName</span><span class="token punctuation">(</span>TextStyle<span class="token punctuation">.</span>FULL<span class="token punctuation">,</span> Locale<span class="token punctuation">.</span>CHINESE<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"DayOfWeek().getDisplayName: "</span> <span class="token operator">+</span> localDate<span class="token punctuation">.</span><span class="token function">getDayOfWeek</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getDisplayName</span><span class="token punctuation">(</span>TextStyle<span class="token punctuation">.</span>NARROW<span class="token punctuation">,</span> Locale<span class="token punctuation">.</span>CHINESE<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// getMonth()与getDayOfWeek()方法返回了一个枚举类型代替一个int。你可以通过枚举类型中的getValue()来获得信息</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>year <span class="token operator">+</span> <span class="token string">" 年 "</span> <span class="token operator">+</span> month <span class="token operator">+</span> <span class="token string">" 月 "</span> <span class="token operator">+</span> dayOfMonth <span class="token operator">+</span> <span class="token string">" 日 "</span> <span class="token operator">+</span> <span class="token string">" 星期"</span> <span class="token operator">+</span> dayOfWeek<span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"一年中的第"</span> <span class="token operator">+</span> dayOfYear <span class="token operator">+</span> <span class="token string">"天"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// 日期年、月、日、周的加减</span>        LocalDate plusYears <span class="token operator">=</span> localDate<span class="token punctuation">.</span><span class="token function">plusYears</span><span class="token punctuation">(</span>3L<span class="token punctuation">)</span><span class="token punctuation">;</span>        LocalDate minusWeeks <span class="token operator">=</span> localDate<span class="token punctuation">.</span><span class="token function">minusWeeks</span><span class="token punctuation">(</span>3L<span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"plusYears: "</span> <span class="token operator">+</span> plusYears <span class="token operator">+</span> <span class="token string">" minusWeeks: "</span> <span class="token operator">+</span> minusWeeks<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">/**     * LocalTime类是Java 8中日期时间功能里表示一整天中某个时间点的类，它的时间是无时区属性的（早上10点等等）。     * 比如你需要描述学校几点开学，这个时间不涉及在什么城市，这个描述是对任何国家城市都适用的，此时使用无时区的LocalTime就足够了。     * LocalTime类的对象也是不可变的，所以计算方法会返回一个新的LocalTime实例。     */</span>    <span class="token annotation punctuation">@Test</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testLocalTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        LocalTime localTime <span class="token operator">=</span> LocalTime<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        LocalTime localTime1 <span class="token operator">=</span> LocalTime<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">38</span><span class="token punctuation">,</span> <span class="token number">59</span><span class="token punctuation">,</span> <span class="token number">11001</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"now: "</span> <span class="token operator">+</span> localTime <span class="token operator">+</span> <span class="token string">" of: "</span> <span class="token operator">+</span> localTime1<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">int</span> hour <span class="token operator">=</span> localTime<span class="token punctuation">.</span><span class="token function">getHour</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">int</span> minute <span class="token operator">=</span> localTime<span class="token punctuation">.</span><span class="token function">getMinute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">int</span> second <span class="token operator">=</span> localTime<span class="token punctuation">.</span><span class="token function">getSecond</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">int</span> nano <span class="token operator">=</span> localTime<span class="token punctuation">.</span><span class="token function">getNano</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// 时间 时、分、秒、纳秒的加减</span>        LocalTime plusHours <span class="token operator">=</span> localTime<span class="token punctuation">.</span><span class="token function">plusHours</span><span class="token punctuation">(</span>3L<span class="token punctuation">)</span><span class="token punctuation">;</span>        LocalTime minusNanos <span class="token operator">=</span> localTime<span class="token punctuation">.</span><span class="token function">minusNanos</span><span class="token punctuation">(</span>1000L<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">/**     * LocalDateTime类是Java 8中日期时间功能里，用于表示当地的日期与时间的类，它的值是无时区属性的。     * 你可以将其视为Java 8中LocalDate与LocalTime两个类的结合。     * LocalDateTime类的值是不可变的，所以其计算方法会返回一个新的LocalDateTime实例。     */</span>    <span class="token annotation punctuation">@Test</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testLocalDateTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        LocalDateTime localDateTime <span class="token operator">=</span> LocalDateTime<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        LocalDateTime localDateTime1 <span class="token operator">=</span> LocalDateTime<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token number">2021</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">45</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// 访问日期和时间，年、月、日、时、分、秒、毫秒</span>        <span class="token keyword">int</span> year <span class="token operator">=</span> localDateTime<span class="token punctuation">.</span><span class="token function">getYear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        Month month <span class="token operator">=</span> localDateTime<span class="token punctuation">.</span><span class="token function">getMonth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// 日期时间的加减</span>        LocalDateTime plusYears <span class="token operator">=</span> localDateTime<span class="token punctuation">.</span><span class="token function">plusYears</span><span class="token punctuation">(</span>3L<span class="token punctuation">)</span><span class="token punctuation">;</span>        LocalDateTime minusNanos <span class="token operator">=</span> localDateTime<span class="token punctuation">.</span><span class="token function">minusNanos</span><span class="token punctuation">(</span>1000L<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">/**     * ZonedDateTime类是Java 8中日期时间功能里，用于表示带时区的日期与时间信息的类。     * 可以用于表示一个真实事件的开始时间，如某火箭升空时间等等。     * ZonedDateTime 类的值是不可变的，所以其计算方法会返回一个新的ZonedDateTime 实例。     */</span>    <span class="token annotation punctuation">@Test</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testZoneDateTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        ZonedDateTime zonedDateTime <span class="token operator">=</span> ZonedDateTime<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        ZoneId zoneId <span class="token operator">=</span> ZoneId<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token string">"UTC+1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        ZonedDateTime zonedDateTime1 <span class="token operator">=</span> ZonedDateTime<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token number">2015</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">23</span><span class="token punctuation">,</span> <span class="token number">45</span><span class="token punctuation">,</span> <span class="token number">59</span><span class="token punctuation">,</span> <span class="token number">1234</span><span class="token punctuation">,</span> zoneId<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// 访问ZonedDateTime对象的时间</span>        <span class="token keyword">int</span> year <span class="token operator">=</span> zonedDateTime<span class="token punctuation">.</span><span class="token function">getYear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// ZonedDateTime的计算</span>        ZonedDateTime plusYears <span class="token operator">=</span> zonedDateTime<span class="token punctuation">.</span><span class="token function">plusYears</span><span class="token punctuation">(</span>3L<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// 但注意计算时，若不巧跨越了夏令时（会补一小时或减一小时），可能得不到希望的结果。一个替代的正确做法是使用Period：</span>        ZonedDateTime period <span class="token operator">=</span> zonedDateTime<span class="token punctuation">.</span><span class="token function">plus</span><span class="token punctuation">(</span>Period<span class="token punctuation">.</span><span class="token function">ofDays</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">/**     * DateTimeFormatter类是Java 8中日期时间功能里，用于解析和格式化日期时间的类     */</span>    <span class="token annotation punctuation">@Test</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testDateTimeFormatter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        DateTimeFormatter formatter <span class="token operator">=</span> DateTimeFormatter<span class="token punctuation">.</span>BASIC_ISO_DATE<span class="token punctuation">;</span>        String localDateTime <span class="token operator">=</span> formatter<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span>LocalDateTime<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>localDateTime<span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>formatter<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span>ZonedDateTime<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">/**     * 一个Duration对象表示两个Instant间的一段时间，是在Java 8中加入的新功能。     * 一个Duration实例是不可变的，当创建出对象后就不能改变它的值了。     * 你只能通过Duration的计算方法，来创建出一个新的Duration对象。     */</span>    <span class="token annotation punctuation">@Test</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testDuration</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        Instant first <span class="token operator">=</span> Instant<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">try</span> <span class="token punctuation">{</span>            Thread<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        Instant second <span class="token operator">=</span> Instant<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        Duration duration <span class="token operator">=</span> Duration<span class="token punctuation">.</span><span class="token function">between</span><span class="token punctuation">(</span>first<span class="token punctuation">,</span> second<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">long</span> seconds <span class="token operator">=</span> duration<span class="token punctuation">.</span><span class="token function">getSeconds</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">int</span> nanos <span class="token operator">=</span> duration<span class="token punctuation">.</span><span class="token function">getNano</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"duration: "</span> <span class="token operator">+</span> duration <span class="token operator">+</span> <span class="token string">" seconds: "</span> <span class="token operator">+</span> seconds <span class="token operator">+</span> <span class="token string">" nanos: "</span> <span class="token operator">+</span> nanos<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// 时间转换</span>        <span class="token keyword">long</span> millis <span class="token operator">=</span> duration<span class="token punctuation">.</span><span class="token function">toMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">long</span> toNanos <span class="token operator">=</span> duration<span class="token punctuation">.</span><span class="token function">toNanos</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"millis: "</span> <span class="token operator">+</span> millis <span class="token operator">+</span> <span class="token string">" toNanos: "</span> <span class="token operator">+</span> toNanos<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// 时间加减</span>        Duration plusDays <span class="token operator">=</span> duration<span class="token punctuation">.</span><span class="token function">plusDays</span><span class="token punctuation">(</span>3L<span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"plusDays: "</span> <span class="token operator">+</span> plusDays<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">/**     * Java 8中的日期/时间类都是不可变的，这是为了保证线程安全。     * 当然，新的日期/时间类也提供了方法用于创建对象的可变版本，比如增加一天或者减少一天     */</span>    <span class="token annotation punctuation">@Test</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testOther</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        LocalDate date <span class="token operator">=</span> LocalDate<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token number">2017</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token comment" spellcheck="true">// 2017-01-05</span>        LocalDate date1 <span class="token operator">=</span> date<span class="token punctuation">.</span><span class="token function">withYear</span><span class="token punctuation">(</span><span class="token number">2016</span><span class="token punctuation">)</span><span class="token punctuation">;</span>              <span class="token comment" spellcheck="true">// 修改为 2016-01-05</span>        LocalDate date2 <span class="token operator">=</span> date<span class="token punctuation">.</span><span class="token function">withMonth</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token comment" spellcheck="true">// 修改为 2017-02-05</span>        LocalDate date3 <span class="token operator">=</span> date<span class="token punctuation">.</span><span class="token function">withDayOfMonth</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>           <span class="token comment" spellcheck="true">// 修改为 2017-01-01</span>        LocalDate date4 <span class="token operator">=</span> date<span class="token punctuation">.</span><span class="token function">plusYears</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token comment" spellcheck="true">// 增加一年 2018-01-05</span>        LocalDate date5 <span class="token operator">=</span> date<span class="token punctuation">.</span><span class="token function">minusMonths</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>              <span class="token comment" spellcheck="true">// 减少两个月 2016-11-05</span>        LocalDate date6 <span class="token operator">=</span> date<span class="token punctuation">.</span><span class="token function">plus</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> ChronoUnit<span class="token punctuation">.</span>DAYS<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// 增加5天 2017-01-10</span>        LocalDate date7 <span class="token operator">=</span> date<span class="token punctuation">.</span><span class="token function">with</span><span class="token punctuation">(</span>TemporalAdjusters<span class="token punctuation">.</span><span class="token function">nextOrSame</span><span class="token punctuation">(</span>DayOfWeek<span class="token punctuation">.</span>SUNDAY<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment" spellcheck="true">// 返回下一个距离当前时间最近的星期日</span>        LocalDate date9 <span class="token operator">=</span> date<span class="token punctuation">.</span><span class="token function">with</span><span class="token punctuation">(</span>TemporalAdjusters<span class="token punctuation">.</span><span class="token function">lastInMonth</span><span class="token punctuation">(</span>DayOfWeek<span class="token punctuation">.</span>SATURDAY<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment" spellcheck="true">// 返回本月最后一个星期六</span>        <span class="token comment" spellcheck="true">// 自定义TemporalAdjuster 接口的实现， 比如给定一个日期，计算该日期的下一个工作日（不包括星期六和星期天）</span>        LocalDate date10 <span class="token operator">=</span> date<span class="token punctuation">.</span><span class="token function">with</span><span class="token punctuation">(</span>temporal <span class="token operator">-</span><span class="token operator">></span> <span class="token punctuation">{</span>            <span class="token comment" spellcheck="true">// 当前日期</span>            DayOfWeek dayOfWeek <span class="token operator">=</span> DayOfWeek<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>temporal<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>ChronoField<span class="token punctuation">.</span>DAY_OF_WEEK<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment" spellcheck="true">// 正常情况下，每次增加一天</span>            <span class="token keyword">int</span> dayToAdd <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>            <span class="token comment" spellcheck="true">// 如果是星期五，增加三天</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>dayOfWeek <span class="token operator">==</span> DayOfWeek<span class="token punctuation">.</span>FRIDAY<span class="token punctuation">)</span> dayToAdd <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>            <span class="token comment" spellcheck="true">// 如果是星期六，增加两天</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>dayOfWeek <span class="token operator">==</span> DayOfWeek<span class="token punctuation">.</span>SATURDAY<span class="token punctuation">)</span> dayToAdd <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>            <span class="token keyword">return</span> temporal<span class="token punctuation">.</span><span class="token function">plus</span><span class="token punctuation">(</span>dayToAdd<span class="token punctuation">,</span> ChronoUnit<span class="token punctuation">.</span>DAYS<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">/**     * Java中使用的历法是ISO 8601日历系统，它是世界民用历法，也就是我们所说的公历。平年有365天，闰年是366天。     * 闰年的定义是：非世纪年，能被4整除；世纪年能被400整除。为了计算的一致性，公元1年的前一年被当做公元0年，以此类推。     * 此外Java 8还提供了4套其他历法，每套历法都包含一个日期类，分别是     * ThaiBuddhistDate：泰国佛教历     * MinguoDate：中华民国历     * JapaneseDate：日本历     * HijrahDate：伊斯兰历     * 每个日期类都继承 ChronoLocalDate 类     */</span>    <span class="token annotation punctuation">@Test</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testOther2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        LocalDate date <span class="token operator">=</span> LocalDate<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        JapaneseDate jpDate <span class="token operator">=</span> JapaneseDate<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>date<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// 不知道具体历法情况下，可以通过ChronoLocalDate类操作日期</span>        Chronology jpChronology <span class="token operator">=</span> Chronology<span class="token punctuation">.</span><span class="token function">ofLocale</span><span class="token punctuation">(</span>Locale<span class="token punctuation">.</span>JAPANESE<span class="token punctuation">)</span><span class="token punctuation">;</span>        ChronoLocalDate jpChronoLocalDate <span class="token operator">=</span> jpChronology<span class="token punctuation">.</span><span class="token function">dateNow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">// 在实际开发过程中建议使用 LocalDate，包括存储、操作、业务规则的解读；</span>    <span class="token comment" spellcheck="true">// 除非需要将程序的输入或者输出本地化， 这时可以使用 ChronoLocalDate 类。</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// 它通过指定一个时区，然后就可以获取到当前的时刻，日期与时间。</span>        <span class="token comment" spellcheck="true">// Clock可以替换System.currentTimeMillis()与TimeZone.getDefault()</span>        Clock clock <span class="token operator">=</span> Clock<span class="token punctuation">.</span><span class="token function">systemUTC</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// Instant:一个instant对象表示时间轴上的一个时间点，</span>        <span class="token comment" spellcheck="true">// Instant.now()方法会返回当前的瞬时点（格林威治时间）；</span>        <span class="token comment" spellcheck="true">// Duration:用于表示两个瞬时点相差的时间量；</span>        Instant instant <span class="token operator">=</span> clock<span class="token punctuation">.</span><span class="token function">instant</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"instant: "</span> <span class="token operator">+</span> instant<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// LocalDate:一个带有年份，月份和天数的日期，可以使用静态方法now或者of方法进行创建；</span>        LocalDate localDate <span class="token operator">=</span> LocalDate<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"localDate: "</span> <span class="token operator">+</span> localDate<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// LocalTime:表示一天中的某个时间，同样可以使用now和of进行创建</span>        LocalTime localTime <span class="token operator">=</span> LocalTime<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"localTime: "</span> <span class="token operator">+</span> localTime<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// LocalDateTime：兼有日期和时间</span>        LocalDateTime localDateTime <span class="token operator">=</span> LocalDateTime<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"localDateTime: "</span> <span class="token operator">+</span> localDateTime<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// ZonedDateTime：通过设置时间的id来创建一个带时区的时间；</span>        ZonedDateTime zonedDateTime <span class="token operator">=</span> ZonedDateTime<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span>ZoneId<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token string">"Asia/Shanghai"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"zonedDateTime: "</span> <span class="token operator">+</span> zonedDateTime<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// DateTimeFormatter：日期格式化类，提供了多种预定义的标准格式；</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> 编程语言 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> java8 </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
